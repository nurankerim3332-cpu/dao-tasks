<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–¥–∞—á</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: var(--tg-theme-bg-color, #0f0f13);
      --bg2: var(--tg-theme-secondary-bg-color, #1a1a22);
      --text: var(--tg-theme-text-color, #f0f0f5);
      --hint: var(--tg-theme-hint-color, #8888aa);
      --accent: var(--tg-theme-button-color, #6c63ff);
      --accent2: #ff6b6b;
      --accent3: #43e97b;
      --accent4: #f7971e;
      --border: rgba(255,255,255,0.07);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Manrope', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
      padding: 14px 16px 10px;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .header h1 {
      font-size: 20px;
      font-weight: 800;
      letter-spacing: -0.5px;
    }

    .header h1 span { color: var(--accent); }

    .refresh-btn {
      width: 36px; height: 36px;
      border-radius: 50%;
      border: none;
      background: var(--bg2);
      color: var(--hint);
      cursor: pointer;
      font-size: 16px;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s;
    }
    .refresh-btn:active { transform: scale(0.9); color: var(--accent); }
    .refresh-btn.spinning { animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ‚îÄ‚îÄ Search ‚îÄ‚îÄ */
    .search-wrap {
      position: relative;
      margin-bottom: 10px;
    }
    .search-wrap input {
      width: 100%;
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 14px 10px 38px;
      color: var(--text);
      font-family: 'Manrope', sans-serif;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
    }
    .search-wrap input:focus { border-color: var(--accent); }
    .search-wrap input::placeholder { color: var(--hint); }
    .search-icon {
      position: absolute;
      left: 12px; top: 50%;
      transform: translateY(-50%);
      color: var(--hint);
      font-size: 15px;
      pointer-events: none;
    }

    /* ‚îÄ‚îÄ Filter pills ‚îÄ‚îÄ */
    .filters { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 2px; }
    .filters::-webkit-scrollbar { display: none; }

    .filter-group { display: flex; gap: 6px; flex-shrink: 0; }

    .pill {
      padding: 6px 12px;
      border-radius: 20px;
      border: 1px solid var(--border);
      background: var(--bg2);
      color: var(--hint);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.18s;
      font-family: 'Manrope', sans-serif;
    }
    .pill.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }
    .pill-sep {
      width: 1px;
      background: var(--border);
      flex-shrink: 0;
    }

    /* ‚îÄ‚îÄ Stats bar ‚îÄ‚îÄ */
    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      padding: 12px 16px;
    }
    .stat-card {
      background: var(--bg2);
      border-radius: 12px;
      padding: 10px 8px;
      text-align: center;
      border: 1px solid var(--border);
    }
    .stat-num {
      font-size: 20px;
      font-weight: 800;
      line-height: 1;
      margin-bottom: 2px;
    }
    .stat-label { font-size: 10px; color: var(--hint); font-weight: 500; }

    /* ‚îÄ‚îÄ Task list ‚îÄ‚îÄ */
    .task-list { padding: 0 16px 100px; }

    .task-card {
      background: var(--bg2);
      border-radius: 16px;
      border: 1px solid var(--border);
      padding: 14px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.18s;
      animation: fadeUp 0.3s ease both;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .task-card:active { transform: scale(0.98); border-color: var(--accent); }

    .task-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    .task-title {
      font-size: 14px;
      font-weight: 700;
      line-height: 1.3;
      flex: 1;
    }

    .priority-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 4px;
    }
    .priority-dot.high    { background: var(--accent2); box-shadow: 0 0 6px var(--accent2); }
    .priority-dot.medium  { background: var(--accent4); box-shadow: 0 0 6px var(--accent4); }
    .priority-dot.low     { background: var(--accent3); box-shadow: 0 0 6px var(--accent3); }
    .priority-dot.normal  { background: var(--hint); }

    .task-desc {
      font-size: 12px;
      color: var(--hint);
      line-height: 1.4;
      margin-bottom: 10px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .task-footer {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .badge {
      padding: 3px 9px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.2px;
    }
    .badge.new       { background: rgba(108,99,255,0.18); color: #9b94ff; }
    .badge.progress  { background: rgba(247,151,30,0.18); color: var(--accent4); }
    .badge.done      { background: rgba(67,233,123,0.18); color: var(--accent3); }
    .badge.hold      { background: rgba(136,136,170,0.18); color: var(--hint); }
    .badge.review    { background: rgba(255,107,107,0.18); color: var(--accent2); }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      color: var(--hint);
    }
    .meta-item.overdue { color: var(--accent2); }

    .deadline-block {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 10px;
    }
    .deadline-block.ok-block      { background: rgba(67,233,123,0.07); }
    .deadline-block.soon-block    { background: rgba(247,151,30,0.1); }
    .deadline-block.overdue-block { background: rgba(255,107,107,0.1); }
    .deadline-block.done-block    { background: rgba(67,233,123,0.07); opacity:0.6; }

    .deadline-left { display: flex; flex-direction: column; gap: 2px; }
    .deadline-label { font-size: 9px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; color: var(--hint); }
    .deadline-date { font-size: 13px; font-weight: 700; }
    .deadline-date.ok      { color: var(--text); }
    .deadline-date.soon    { color: var(--accent4); }
    .deadline-date.overdue { color: var(--accent2); }
    .deadline-date.done    { color: var(--accent3); }

    .deadline-countdown {
      font-size: 12px; font-weight: 800;
      padding: 4px 10px; border-radius: 20px; white-space: nowrap;
    }
    .deadline-countdown.ok      { background: rgba(67,233,123,0.15); color: var(--accent3); }
    .deadline-countdown.soon    { background: rgba(247,151,30,0.2);  color: var(--accent4); }
    .deadline-countdown.overdue { background: rgba(255,107,107,0.2); color: var(--accent2); }
    .deadline-countdown.done    { background: rgba(67,233,123,0.15); color: var(--accent3); }

    .deadline-progress { height: 3px; background: var(--border); overflow: hidden; border-radius: 0 0 16px 16px; }
    .deadline-progress-fill { height: 100%; border-radius: 2px; transition: width 0.3s; }
    .deadline-progress-fill.ok      { background: var(--accent3); }
    .deadline-progress-fill.soon    { background: var(--accent4); }
    .deadline-progress-fill.overdue { background: var(--accent2); }
    .deadline-progress-fill.done    { background: var(--accent3); opacity:0.4; }

    /* ‚îÄ‚îÄ Detail modal ‚îÄ‚îÄ */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(6px);
      z-index: 200;
      display: flex;
      align-items: flex-end;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    .modal-overlay.open { opacity: 1; pointer-events: all; }

    .modal {
      background: var(--bg2);
      border-radius: 24px 24px 0 0;
      padding: 20px 20px 40px;
      width: 100%;
      max-height: 85vh;
      overflow-y: auto;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1);
      border-top: 1px solid var(--border);
    }
    .modal-overlay.open .modal { transform: translateY(0); }

    .modal-handle {
      width: 40px; height: 4px;
      background: var(--border);
      border-radius: 2px;
      margin: 0 auto 16px;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 16px;
      line-height: 1.3;
    }

    .detail-row {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
      align-items: flex-start;
    }
    .detail-label {
      font-size: 12px;
      color: var(--hint);
      font-weight: 600;
      min-width: 100px;
      padding-top: 2px;
    }
    .detail-value {
      font-size: 13px;
      font-weight: 500;
      flex: 1;
      line-height: 1.4;
    }

    .divider {
      height: 1px;
      background: var(--border);
      margin: 14px 0;
    }

    .modal-desc {
      font-size: 13px;
      color: var(--hint);
      line-height: 1.6;
    }

    .close-btn {
      width: 100%;
      padding: 13px;
      border-radius: 14px;
      border: none;
      background: var(--accent);
      color: #fff;
      font-family: 'Manrope', sans-serif;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      margin-top: 20px;
    }

    /* ‚îÄ‚îÄ Empty / Loading ‚îÄ‚îÄ */
    .center-msg {
      text-align: center;
      padding: 60px 20px;
      color: var(--hint);
    }
    .center-msg .icon { font-size: 48px; margin-bottom: 12px; }
    .center-msg p { font-size: 14px; }

    .skeleton {
      background: linear-gradient(90deg, var(--bg2) 25%, rgba(255,255,255,0.04) 50%, var(--bg2) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.4s infinite;
      border-radius: 16px;
      height: 100px;
      margin-bottom: 10px;
    }
    @keyframes shimmer { to { background-position: -200% 0; } }

    .empty-filtered {
      text-align: center;
      padding: 40px 20px;
      color: var(--hint);
      font-size: 14px;
    }

    /* ‚îÄ‚îÄ FAB –∫–Ω–æ–ø–∫–∞ ‚îÄ‚îÄ */
    .fab {
      position: fixed;
      bottom: 24px;
      right: 20px;
      width: 56px; height: 56px;
      border-radius: 50%;
      background: var(--accent);
      border: none;
      color: #fff;
      font-size: 28px;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 4px 20px rgba(108,99,255,0.5);
      z-index: 150;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .fab:active { transform: scale(0.92); }

    /* ‚îÄ‚îÄ Add Task Modal ‚îÄ‚îÄ */
    .add-modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(6px);
      z-index: 300;
      display: flex;
      align-items: flex-end;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    .add-modal-overlay.open { opacity: 1; pointer-events: all; }
    .add-modal {
      background: var(--bg2);
      border-radius: 24px 24px 0 0;
      padding: 20px 20px 40px;
      width: 100%;
      max-height: 92vh;
      overflow-y: auto;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1);
      border-top: 1px solid var(--border);
    }
    .add-modal-overlay.open .add-modal { transform: translateY(0); }
    .add-modal h2 { font-size: 18px; font-weight: 800; margin-bottom: 18px; }
    .form-field { margin-bottom: 14px; }
    .form-label { font-size: 12px; font-weight: 600; color: var(--hint); margin-bottom: 6px; display: block; }
    .form-label span { color: var(--accent2); }
    .form-input, .form-textarea, .form-select {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 11px 14px;
      color: var(--text);
      font-family: 'Manrope', sans-serif;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
      -webkit-appearance: none;
    }
    .form-input:focus, .form-textarea:focus, .form-select:focus { border-color: var(--accent); }
    .form-input::placeholder, .form-textarea::placeholder { color: var(--hint); }
    .form-textarea { resize: none; height: 80px; line-height: 1.5; }
    .form-select option { background: #1a1a22; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .submit-btn {
      width: 100%; padding: 14px; border-radius: 14px; border: none;
      background: var(--accent); color: #fff; font-family: 'Manrope', sans-serif;
      font-size: 15px; font-weight: 700; cursor: pointer; margin-top: 6px; transition: opacity 0.2s;
    }
    .submit-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .cancel-btn {
      width: 100%; padding: 12px; border-radius: 14px; border: 1px solid var(--border);
      background: transparent; color: var(--hint); font-family: 'Manrope', sans-serif;
      font-size: 14px; font-weight: 600; cursor: pointer; margin-top: 8px;
    }
    .form-success { text-align: center; padding: 30px 20px; }
    .form-success .icon { font-size: 52px; margin-bottom: 12px; }
    .form-success h3 { font-size: 18px; font-weight: 800; margin-bottom: 6px; }
    .form-success p { font-size: 13px; color: var(--hint); }
  </style>
</head>
<body>

<div class="header">
  <div class="header-top">
    <h1>–ó–∞–¥–∞—á–∏ <span>–î–ê–û–ì—Ä—É–ø</span></h1>
    <button class="refresh-btn" id="refreshBtn" title="–û–±–Ω–æ–≤–∏—Ç—å">‚Üª</button>
  </div>
  <div class="search-wrap">
    <span class="search-icon">üîç</span>
    <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é...">
  </div>
  <div class="filters">
    <div class="filter-group" id="statusFilters">
      <button class="pill active" data-status="all">–í—Å–µ</button>
      <button class="pill" data-status="new">–ù–æ–≤—ã–µ</button>
      <button class="pill" data-status="progress">–í —Ä–∞–±–æ—Ç–µ</button>
      <button class="pill" data-status="review">–ü—Ä–æ–≤–µ—Ä–∫–∞</button>
      <button class="pill" data-status="done">–ì–æ—Ç–æ–≤–æ</button>
      <button class="pill" data-status="hold">–ü–∞—É–∑–∞</button>
    </div>
    <div class="pill-sep"></div>
    <div class="filter-group" id="priorityFilters">
      <button class="pill active" data-priority="all">üîµ –í—Å–µ</button>
      <button class="pill" data-priority="high">üî¥ –í—ã—Å–æ–∫–∏–π</button>
      <button class="pill" data-priority="medium">üü° –°—Ä–µ–¥–Ω–∏–π</button>
      <button class="pill" data-priority="low">üü¢ –ù–∏–∑–∫–∏–π</button>
    </div>
  </div>
</div>

<div class="stats" id="statsBar">
  <div class="stat-card"><div class="stat-num" id="sTotal">‚Äî</div><div class="stat-label">–í—Å–µ–≥–æ</div></div>
  <div class="stat-card"><div class="stat-num" style="color:var(--accent4)" id="sProgress">‚Äî</div><div class="stat-label">–í —Ä–∞–±–æ—Ç–µ</div></div>
  <div class="stat-card"><div class="stat-num" style="color:var(--accent3)" id="sDone">‚Äî</div><div class="stat-label">–ì–æ—Ç–æ–≤–æ</div></div>
  <div class="stat-card"><div class="stat-num" style="color:var(--accent2)" id="sOverdue">‚Äî</div><div class="stat-label">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</div></div>
</div>

<div class="task-list" id="taskList">
  <div class="skeleton"></div>
  <div class="skeleton" style="height:80px;opacity:0.6"></div>
  <div class="skeleton" style="height:120px;opacity:0.3"></div>
</div>

<!-- Detail Modal -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal" id="modal">
    <div class="modal-handle"></div>
    <div class="modal-title" id="modalTitle"></div>
    <div id="modalBody"></div>
    <button class="close-btn" id="closeModal">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>


<!-- FAB -->
<button class="fab" id="fabBtn" title="–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É">+</button>

<!-- Add Task Modal -->
<div class="add-modal-overlay" id="addModalOverlay">
  <div class="add-modal" id="addModal">
    <div class="modal-handle"></div>
    <div id="addFormContent">
      <h2>‚úèÔ∏è –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h2>
      <div class="form-field">
        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ <span>*</span></label>
        <input class="form-input" id="fTitle" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏..." maxlength="200">
      </div>
      <div class="form-field">
        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
        <textarea class="form-textarea" id="fDesc" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ..."></textarea>
      </div>
      <div class="form-row">
        <div class="form-field">
          <label class="form-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
          <select class="form-select" id="fPriority">
            <option value="–ù–æ—Ä–º–∞–ª—å–Ω—ã–π">‚ö™ –ù–æ—Ä–º–∞–ª—å–Ω—ã–π</option>
            <option value="–ù–∏–∑–∫–∏–π">üü¢ –ù–∏–∑–∫–∏–π</option>
            <option value="–í—ã—Å–æ–∫–∏–π">üü° –í—ã—Å–æ–∫–∏–π</option>
            <option value="–ö—Ä–∏—Ç–∏—á–Ω–æ">üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ</option>
          </select>
        </div>
        <div class="form-field">
          <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
          <select class="form-select" id="fStatus">
            <option value="–ù–æ–≤–∞—è">–ù–æ–≤–∞—è</option>
            <option value="–í –ø—Ä–æ—Ü–µ—Å—Å–µ">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</option>
            <option value="–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ">–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</option>
            <option value="–í—ã–ø–æ–ª–Ω–µ–Ω–æ">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
          </select>
        </div>
      </div>
      <div class="form-field">
        <label class="form-label">–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</label>
        <input class="form-input" id="fAssigned" placeholder="–ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞...">
      </div>
      <div class="form-row">
        <div class="form-field">
          <label class="form-label">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
          <input class="form-input" type="date" id="fStartDate">
        </div>
        <div class="form-field">
          <label class="form-label">–°—Ä–æ–∫ —Å–¥–∞—á–∏</label>
          <input class="form-input" type="date" id="fDueDate">
        </div>
      </div>
      <button class="submit-btn" id="submitTaskBtn">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</button>
      <button class="cancel-btn" id="cancelAddBtn">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready();
  tg.expand();

  // ‚ö†Ô∏è –ó–ê–ú–ï–ù–ò –ù–ê –°–í–û–ô URL –ò–ó POWER AUTOMATE / MAKE.COM
  const API_URL = 'https://default98f669c93c304d33969094a178c687.11.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/ff3cbd1dc1524e3fb6a57cb83635138a/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=5zrRQuxYpDzc9fdL-79dXiIXABAUUPiCAIM7TzwyuN8';

  let allTasks = [];
  let activeStatus = 'all';
  let activePriority = 'all';
  let searchQuery = '';

  // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function getStatusKey(s) {
    if (!s) return 'new';
    const v = s.toLowerCase();
    // –í –ø—Ä–æ—Ü–µ—Å—Å–µ / –í —Ä–∞–±–æ—Ç–µ
    if (v.includes('–ø—Ä–æ—Ü–µ—Å') || v.includes('—Ä–∞–±–æ—Ç') || v.includes('progress') || v.includes('in progress')) return 'progress';
    // –í—ã–ø–æ–ª–Ω–µ–Ω–æ / –ì–æ—Ç–æ–≤–æ / –ó–∞–≤–µ—Ä—à–µ–Ω–æ
    if (v.includes('–≤—ã–ø–æ–ª–Ω') || v.includes('–≥–æ—Ç–æ–≤') || v.includes('done') || v.includes('–∑–∞–≤–µ—Ä—à–µ–Ω') || v.includes('complete')) return 'done';
    // –ù–∞ –ø–∞—É–∑–µ / –û—Ç–ª–æ–∂–µ–Ω–æ
    if (v.includes('–ø–∞—É–∑') || v.includes('hold') || v.includes('–æ—Ç–ª–æ–∂–µ–Ω') || v.includes('–∑–∞–º–æ—Ä–æ–∂')) return 'hold';
    // –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ / Review
    if (v.includes('–ø—Ä–æ–≤–µ—Ä') || v.includes('review') || v.includes('—Ç–µ—Å—Ç–∏—Ä')) return 'review';
    // –ù–æ–≤–∞—è
    if (v.includes('–Ω–æ–≤') || v.includes('new') || v.includes('–æ—Ç–∫—Ä—ã—Ç') || v.includes('open')) return 'new';
    return 'new';
  }

  function getStatusLabel(k) {
    return { new:'–ù–æ–≤–∞—è', progress:'–í —Ä–∞–±–æ—Ç–µ', done:'–ì–æ—Ç–æ–≤–æ', hold:'–ù–∞ –ø–∞—É–∑–µ', review:'–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ' }[k] || k;
  }

  function getPriorityKey(p) {
    if (!p) return 'normal';
    const v = p.toLowerCase();
    // –ö—Ä–∏—Ç–∏—á–Ω–æ / –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π ‚Üí –≤—ã—Å–æ–∫–∏–π
    if (v.includes('–∫—Ä–∏—Ç–∏—á') || v.includes('critical') || v.includes('–≤—ã—Å–æ–∫') || v.includes('high') || v === '1') return 'high';
    // –°—Ä–µ–¥–Ω–∏–π / Medium
    if (v.includes('—Å—Ä–µ–¥–Ω') || v.includes('medium') || v === '2') return 'medium';
    // –ù–∏–∑–∫–∏–π / Low
    if (v.includes('–Ω–∏–∑–∫') || v.includes('low') || v === '3') return 'low';
    // –ù–æ—Ä–º–∞–ª—å–Ω—ã–π / Normal
    if (v.includes('–Ω–æ—Ä–º–∞–ª') || v.includes('normal') || v.includes('–æ–±—ã—á–Ω')) return 'normal';
    return 'normal';
  }

  function getPriorityLabel(k) {
    return { high:'üî¥ –í—ã—Å–æ–∫–∏–π', medium:'üü° –°—Ä–µ–¥–Ω–∏–π', low:'üü¢ –ù–∏–∑–∫–∏–π', normal:'‚ö™ –û–±—ã—á–Ω—ã–π' }[k] || k;
  }

  function formatDate(d) {
    if (!d) return null;
    try {
      const dt = new Date(d);
      return dt.toLocaleDateString('ru-RU', { day:'2-digit', month:'2-digit', year:'numeric' });
    } catch { return d; }
  }

  function isOverdue(d) {
    if (!d) return false;
    return new Date(d) < new Date();
  }

  function getDaysLeft(d) {
    if (!d) return null;
    return Math.ceil((new Date(d) - new Date()) / (1000 * 60 * 60 * 24));
  }

  function getDeadlineStatus(daysLeft, isDone) {
    if (isDone) return 'done';
    if (daysLeft === null) return null;
    if (daysLeft < 0) return 'overdue';
    if (daysLeft <= 3) return 'soon';
    return 'ok';
  }

  function getCountdownText(daysLeft, isDone) {
    if (isDone) return '‚úì –ì–æ—Ç–æ–≤–æ';
    if (daysLeft === null) return '';
    if (daysLeft < 0) return '–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –Ω–∞ ' + Math.abs(daysLeft) + ' –¥–Ω.';
    if (daysLeft === 0) return '—Å–µ–≥–æ–¥–Ω—è!';
    if (daysLeft === 1) return '–∑–∞–≤—Ç—Ä–∞';
    return daysLeft + ' –¥–Ω.';
  }

  function getProgress(startDate, dueDate, isDone) {
    if (isDone) return 100;
    if (!dueDate) return 0;
    const end = new Date(dueDate);
    const start = startDate ? new Date(startDate) : new Date(end - 7*24*60*60*1000);
    const now = new Date();
    const total = end - start;
    if (total <= 0) return 100;
    return Math.min(100, Math.max(0, Math.round(((now - start) / total) * 100)));
  }

  // ‚îÄ‚îÄ Deadline block renderer ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderDeadlineBlock(t, sk) {
    const dl = getDaysLeft(t.dueDate);
    const ds = getDeadlineStatus(dl, sk === 'done');
    const prog = getProgress(t.startDate, t.dueDate, sk === 'done');
    const due = formatDate(t.dueDate);
    return `
      <div class="deadline-block ${ds}-block">
        <div class="deadline-left">
          <div class="deadline-label">–°—Ä–æ–∫ —Å–¥–∞—á–∏</div>
          <div class="deadline-date ${ds}">${due}</div>
        </div>
        <div class="deadline-countdown ${ds}">${getCountdownText(dl, sk === 'done')}</div>
      </div>
      <div class="deadline-progress">
        <div class="deadline-progress-fill ${ds}" style="width:${prog}%"></div>
      </div>`;
  }

  // ‚îÄ‚îÄ Fetch tasks ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function loadTasks() {
    const btn = document.getElementById('refreshBtn');
    btn.classList.add('spinning');

    try {
      const res = await fetch(API_URL, { method: 'POST' });
      const text = await res.text();
      console.log('API response:', text.substring(0, 500));
      let data;
      try { data = JSON.parse(text); } catch(e) { data = {}; }

      // –ò—â–µ–º –º–∞—Å—Å–∏–≤ –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ –æ—Ç–≤–µ—Ç–∞
      let items = [];
      if (Array.isArray(data)) items = data;
      else if (Array.isArray(data.value)) items = data.value;
      else if (Array.isArray(data.tasks)) items = data.tasks;
      else if (data.body) {
        const b = typeof data.body === 'string' ? JSON.parse(data.body) : data.body;
        items = Array.isArray(b) ? b : (Array.isArray(b.value) ? b.value : []);
      } else {
        for (const key of Object.keys(data)) {
          if (Array.isArray(data[key])) { items = data[key]; break; }
        }
      }

      allTasks = items.map(item => {
        const f = item.fields || item;

        // SharePoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç lookup-–ø–æ–ª—è –∫–∞–∫ –æ–±—ä–µ–∫—Ç—ã { Value: "...", Id: N }
        function extractVal(field) {
          if (!field) return '';
          if (typeof field === 'string') return field;
          if (typeof field === 'object') return field.Value || field.LookupValue || field.Title || String(field.Id || '');
          return String(field);
        }

        // –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π ‚Äî –æ–±—ä–µ–∫—Ç —Å Claims –∏–ª–∏ LookupValue
        function extractUser(field) {
          if (!field) return '';
          if (typeof field === 'string') return field;
          if (typeof field === 'object') {
            // –ë–µ—Ä—ë–º DisplayName, LookupValue –∏–ª–∏ email –∏–∑ Claims
            if (field.DisplayName) return field.DisplayName;
            if (field.LookupValue) return field.LookupValue;
            if (field.Claims) {
              const m = field.Claims.match(/\|([^|]+)$/);
              return m ? m[1] : field.Claims;
            }
          }
          return '';
        }

        return {
          id:          f.id || f.ID || f.ItemInternalId || Math.random(),
          title:       f.Title || f.–ù–∞–∑–≤–∞–Ω–∏–µ || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
          description: f.Description || f['–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á'] || f.–û–ø–∏—Å–∞–Ω–∏–µ || '',
          status:      extractVal(f.Status || f.–°—Ç–∞—Ç—É—Å || f['–°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏']),
          priority:    extractVal(f.Priority || f.–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç || f['–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç Value']),
          assigned:    extractUser(f.AssignedTo || f.Assignedto0 || f['–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π'] || f.Assigned),
          startDate:   f.Datestartwork || f.StartDate || f['–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç'] || null,
          dueDate:     f.Dateendwork || f.DueDate || f['–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è'] || f.Deadline || null,
          created:     f.Created || null,
        };
      });
      updateStats();
      renderTasks();
    } catch (e) {
      document.getElementById('taskList').innerHTML = `
        <div class="center-msg">
          <div class="icon">‚ö†Ô∏è</div>
          <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–¥–∞—á–∏.<br>–ü—Ä–æ–≤–µ—Ä—å URL –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.</p>
          <p style="margin-top:8px;font-size:12px;opacity:0.5">${e.message}</p>
        </div>`;
    } finally {
      btn.classList.remove('spinning');
    }
  }

  // ‚îÄ‚îÄ Stats ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function updateStats() {
    const total    = allTasks.length;
    const progress = allTasks.filter(t => getStatusKey(t.status) === 'progress').length;
    const done     = allTasks.filter(t => getStatusKey(t.status) === 'done').length;
    const overdue  = allTasks.filter(t => isOverdue(t.dueDate) && getStatusKey(t.status) !== 'done').length;
    document.getElementById('sTotal').textContent    = total;
    document.getElementById('sProgress').textContent = progress;
    document.getElementById('sDone').textContent     = done;
    document.getElementById('sOverdue').textContent  = overdue;
  }

  // ‚îÄ‚îÄ Render ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderTasks() {
    const list = document.getElementById('taskList');
    let tasks = allTasks;

    if (activeStatus !== 'all')
      tasks = tasks.filter(t => getStatusKey(t.status) === activeStatus);
    if (activePriority !== 'all')
      tasks = tasks.filter(t => getPriorityKey(t.priority) === activePriority);
    if (searchQuery)
      tasks = tasks.filter(t => t.title.toLowerCase().includes(searchQuery.toLowerCase()));

    if (!tasks.length) {
      list.innerHTML = `<div class="empty-filtered">üîç –ó–∞–¥–∞—á –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.<br>–ü–æ–ø—Ä–æ–±—É–π –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã.</div>`;
      return;
    }

    list.innerHTML = tasks.map((t, i) => {
      const sk = getStatusKey(t.status);
      const pk = getPriorityKey(t.priority);
      const due = formatDate(t.dueDate);
      const over = isOverdue(t.dueDate) && sk !== 'done';

      return `
        <div class="task-card" style="animation-delay:${i * 0.04}s" onclick="openDetail(${JSON.stringify(t).replace(/"/g,'&quot;')})">
          <div class="task-header">
            <div class="task-title">${t.title}</div>
            <div class="priority-dot ${pk}"></div>
          </div>
          ${t.description ? `<div class="task-desc">${t.description}</div>` : ''}
          <div class="task-footer">
            <span class="badge ${sk}">${getStatusLabel(sk)}</span>
            ${t.assigned ? `<span class="meta-item">üë§ ${t.assigned}</span>` : ''}
          </div>
          ${t.dueDate ? renderDeadlineBlock(t, sk) : ''}
        </div>`;
    }).join('');
  }

  // ‚îÄ‚îÄ Detail modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function openDetail(task) {
    if (typeof task === 'string') task = JSON.parse(task);
    const sk = getStatusKey(task.status);
    const pk = getPriorityKey(task.priority);
    const due = formatDate(task.dueDate);
    const over = isOverdue(task.dueDate) && sk !== 'done';

    document.getElementById('modalTitle').textContent = task.title;
    document.getElementById('modalBody').innerHTML = `
      <div class="detail-row">
        <div class="detail-label">–°—Ç–∞—Ç—É—Å</div>
        <div class="detail-value"><span class="badge ${sk}">${getStatusLabel(sk)}</span></div>
      </div>
      <div class="detail-row">
        <div class="detail-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</div>
        <div class="detail-value">${getPriorityLabel(pk)}</div>
      </div>
      ${task.assigned ? `<div class="detail-row">
        <div class="detail-label">–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</div>
        <div class="detail-value">üë§ ${task.assigned}</div>
      </div>` : ''}
      ${task.startDate ? `<div class="detail-row">
        <div class="detail-label">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</div>
        <div class="detail-value">üöÄ ${formatDate(task.startDate)}</div>
      </div>` : ''}
      ${due ? `<div class="detail-row">
        <div class="detail-label">–°—Ä–æ–∫ —Å–¥–∞—á–∏</div>
        <div class="detail-value">
          <div style="font-weight:700;${over ? 'color:var(--accent2)' : getDaysLeft(task.dueDate) <= 3 ? 'color:var(--accent4)' : ''}">
            ${due}${over ? ' ‚Äî –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ!' : ''}
          </div>
          <div style="font-size:11px;margin-top:3px;color:var(--hint)">${getCountdownText(getDaysLeft(task.dueDate), sk === 'done')}</div>
        </div>
      </div>` : ''}
      ${task.description ? `
        <div class="divider"></div>
        <div style="font-size:12px;color:var(--hint);font-weight:600;margin-bottom:6px">–û–ø–∏—Å–∞–Ω–∏–µ</div>
        <div class="modal-desc">${task.description}</div>
      ` : ''}`;

    document.getElementById('modalOverlay').classList.add('open');
    tg.BackButton.show();
    tg.BackButton.onClick(closeDetail);
  }

  function closeDetail() {
    document.getElementById('modalOverlay').classList.remove('open');
    tg.BackButton.hide();
  }

  // ‚îÄ‚îÄ Events ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('closeModal').onclick = closeDetail;
  document.getElementById('modalOverlay').onclick = e => {
    if (e.target === document.getElementById('modalOverlay')) closeDetail();
  };
  document.getElementById('refreshBtn').onclick = loadTasks;

  document.getElementById('searchInput').addEventListener('input', e => {
    searchQuery = e.target.value;
    renderTasks();
  });

  document.getElementById('statusFilters').addEventListener('click', e => {
    const pill = e.target.closest('.pill[data-status]');
    if (!pill) return;
    document.querySelectorAll('[data-status]').forEach(p => p.classList.remove('active'));
    pill.classList.add('active');
    activeStatus = pill.dataset.status;
    renderTasks();
  });

  document.getElementById('priorityFilters').addEventListener('click', e => {
    const pill = e.target.closest('.pill[data-priority]');
    if (!pill) return;
    document.querySelectorAll('[data-priority]').forEach(p => p.classList.remove('active'));
    pill.classList.add('active');
    activePriority = pill.dataset.priority;
    renderTasks();
  });


  // ‚îÄ‚îÄ Add Task ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // ‚ö†Ô∏è –ó–ê–ú–ï–ù–ò –ù–ê URL –°–í–û–ï–ì–û FLOW –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø –ó–ê–î–ê–ß–ò –í POWER AUTOMATE
  const ADD_API_URL = 'https://default98f669c93c304d33969094a178c687.11.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/6a899ff8611c42b480e981d873abd065/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=bopzWCudXSdWiZ9vzn0Mp9TxeYS94Kc5cym13rblt5U';

  const FORM_ORIGINAL_HTML = document.getElementById('addFormContent').innerHTML;

  function openAddModal() {
    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ñ–æ—Ä–º—É (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª—Å—è success)
    document.getElementById('addFormContent').innerHTML = FORM_ORIGINAL_HTML;
    // –ü—Ä–∏–≤—è–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏
    document.getElementById('submitTaskBtn').onclick = submitTask;
    document.getElementById('cancelAddBtn').onclick = closeAddModal;
    document.getElementById('addModalOverlay').classList.add('open');
    tg.BackButton.offClick(closeAddModal);
    tg.BackButton.show();
    tg.BackButton.onClick(closeAddModal);
  }

  function closeAddModal() {
    document.getElementById('addModalOverlay').classList.remove('open');
    tg.BackButton.hide();
  }

  async function submitTask() {
    const title = document.getElementById('fTitle').value.trim();
    if (!title) {
      document.getElementById('fTitle').focus();
      document.getElementById('fTitle').style.borderColor = 'var(--accent2)';
      return;
    }
    document.getElementById('fTitle').style.borderColor = '';

    const btn = document.getElementById('submitTaskBtn');
    btn.disabled = true;
    btn.textContent = '–°–æ–∑–¥–∞—ë–º...';

    const payload = {
      Title:       title,
      Description: document.getElementById('fDesc').value.trim(),
      Priority:    document.getElementById('fPriority').value,
      Status:      document.getElementById('fStatus').value,
      Assigned:    document.getElementById('fAssigned').value.trim(),
      Datestartwork: document.getElementById('fStartDate').value || null,
      Dateendwork:  document.getElementById('fDueDate').value || null,
    };

    try {
      const res = await fetch(ADD_API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      if (res.ok || res.status === 202) {
        // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—Ö
        document.getElementById('addFormContent').innerHTML = `
          <div class="form-success">
            <div class="icon">‚úÖ</div>
            <h3>–ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞!</h3>
            <p style="margin-bottom:20px">"${title}" –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ø–∏—Å–æ–∫</p>
            <button class="submit-btn" onclick="closeAddModal(); loadTasks();">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
            <button class="cancel-btn" onclick="closeAddModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
          </div>`;
      } else {
        throw new Error('HTTP ' + res.status);
      }
    } catch(e) {
      btn.disabled = false;
      btn.textContent = '–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É';
      alert('–û—à–∏–±–∫–∞: ' + e.message + '\n–ü—Ä–æ–≤–µ—Ä—å ADD_API_URL –≤ –∫–æ–¥–µ.');
    }
  }

  // FAB
  document.getElementById('fabBtn').onclick = openAddModal;
  document.getElementById('addModalOverlay').onclick = e => {
    if (e.target === document.getElementById('addModalOverlay')) closeAddModal();
  };

  // ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  loadTasks();
</script>
</body>
</html>
